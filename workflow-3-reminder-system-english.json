{
  "name": "Bookmakgol_Reminder_System",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * *"
            }
          ]
        },
        "timezone": "Asia/Bangkok"
      },
      "id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
      "name": "스케줄 트리거",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "// Calculate tomorrow's date\nconst today = new Date();\nconst tomorrow = new Date(today);\ntomorrow.setDate(tomorrow.getDate() + 1);\n\n// Convert to Bangkok timezone\nconst bangkokTime = new Intl.DateTimeFormat('en-CA', {\n  timeZone: 'Asia/Bangkok',\n  year: 'numeric',\n  month: '2-digit',\n  day: '2-digit'\n}).format(tomorrow);\n\nreturn [{\n  json: {\n    tomorrowDate: bangkokTime,\n    searchStartDate: `${bangkokTime}T00:00:00.000+07:00`,\n    searchEndDate: `${bangkokTime}T23:59:59.999+07:00`\n  }\n}];"
      },
      "id": "2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e",
      "name": "내일 날짜 계산",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        440,
        300
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": "284a2fb1-c15d-81a1-9d93-d4f47300f2e3",
        "returnAll": true,
        "filterType": "manual",
        "matchType": "and",
        "filters": {
          "conditions": [
            {
              "key": "Reservation DateTime",
              "condition": "on_or_after",
              "value": "{{$json.searchStartDate}}"
            },
            {
              "key": "Reservation DateTime",
              "condition": "on_or_before", 
              "value": "{{$json.searchEndDate}}"
            },
            {
              "key": "Status",
              "condition": "equals",
              "value": "Confirmed"
            },
            {
              "key": "Reminder Sent",
              "condition": "equals",
              "value": false
            }
          ]
        }
      },
      "id": "3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f",
      "name": "내일 예약 조회",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        640,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "4d5e6f7a-8b9c-0d1e-2f3a-4b5c6d7e8f9a",
      "name": "예약 존재 확인",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        840,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "// Prepare reminder data for each reservation\nconst reservations = items.map(item => {\n  const properties = item.json.properties;\n  \n  // Extract basic information\n  const bookingNumber = properties['Booking Number'].title[0].plain_text;\n  const pageId = item.json.id;\n  const dateTime = new Date(properties['Reservation DateTime'].date.start);\n  const branch = properties['Branch'].select.name;\n  const spaceType = properties['Space Type'].select.name;\n  const roomNumber = properties['Room Number']?.select?.name;\n  const floor = properties['Floor']?.select?.name;\n  const guests = properties['Guests'].number;\n  const name = properties['Name'].rich_text[0].plain_text;\n  const email = properties['Email'].email;\n  const language = properties['Language'].select.name;\n  const specialRequest = properties['Special Request']?.rich_text[0]?.plain_text || '';\n  \n  // Language settings\n  const langCode = language === 'Korean' ? 'ko' : language === 'Thai' ? 'th' : 'en';\n  \n  // Date formatting\n  const dateFormatted = {\n    ko: dateTime.toLocaleDateString('ko-KR', {\n      timeZone: 'Asia/Bangkok',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      weekday: 'long'\n    }),\n    th: dateTime.toLocaleDateString('th-TH', {\n      timeZone: 'Asia/Bangkok',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      weekday: 'long'\n    }),\n    en: dateTime.toLocaleDateString('en-US', {\n      timeZone: 'Asia/Bangkok',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      weekday: 'long'\n    })\n  };\n  \n  const timeFormatted = dateTime.toLocaleTimeString('en-US', {\n    timeZone: 'Asia/Bangkok',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  });\n  \n  // Branch information\n  const branchInfo = {\n    'Ekamai': {\n      ko: {\n        name: '에까마이 지점',\n        address: '에카마이 BTS 4번 출구, 수쿰윗 병원 맞은편',\n        phone: '095-868-6826'\n      },\n      th: {\n        name: 'สาขาเอกมัย',\n        address: 'BTS เอกมัย ทางออก 4 ตรงข้ามโรงพยาบาลสุขุมวิท',\n        phone: '095-868-6826'\n      },\n      en: {\n        name: 'Ekamai Branch',\n        address: 'BTS Ekamai Exit 4, opposite Sukhumvit Hospital',\n        phone: '095-868-6826'\n      }\n    },\n    'Phrom Phong': {\n      ko: {\n        name: '프롬퐁 지점',\n        address: '수쿰윗 소이 24, 아리스톤 호텔 1층',\n        phone: '02-115-5500'\n      },\n      th: {\n        name: 'สาขาพร้อมพงษ์',\n        address: 'สุขุมวิท ซอย 24 ชั้น 1 โรงแรมอริสตัน',\n        phone: '02-115-5500'\n      },\n      en: {\n        name: 'Phrom Phong Branch',\n        address: 'Sukhumvit Soi 24, 1st Floor Ariston Hotel',\n        phone: '02-115-5500'\n      }\n    }\n  };\n  \n  // Space information\n  const spaceInfo = {\n    ko: spaceType === 'Room' ? `룸 ${roomNumber}` : `홀 ${floor}`,\n    th: spaceType === 'Room' ? `ห้อง${roomNumber.replace('Room ', '')}` : `ชั้น${floor.replace('st Floor', '').replace('nd Floor', '')}`,\n    en: spaceType === 'Room' ? `${roomNumber}` : `${floor}`\n  };\n  \n  // Google Maps links\n  const googleMapsLinks = {\n    'Ekamai': 'https://maps.google.com/?q=Ekamai+BTS+Station+Exit+4',\n    'Phrom Phong': 'https://maps.google.com/?q=Sukhumvit+Soi+24+Ariston+Hotel'\n  };\n  \n  return {\n    pageId,\n    bookingNumber,\n    name,\n    email,\n    language: langCode,\n    dateFormatted: dateFormatted[langCode],\n    timeFormatted,\n    branch,\n    branchInfo: branchInfo[branch][langCode],\n    spaceInfo: spaceInfo[langCode],\n    guests,\n    specialRequest,\n    googleMapsLink: googleMapsLinks[branch]\n  };\n});\n\nreturn reservations.map(reservation => ({ json: reservation }));"
      },
      "id": "5e6f7a8b-9c0d-1e2f-3a4b-5c6d7e8f9a0b",
      "name": "리마인더 데이터 준비",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1040,
        200
      ]
    },
    {
      "parameters": {
        "functionCode": "// Generate language-specific reminder email templates\nconst data = items[0].json;\n\nconst templates = {\n  ko: {\n    subject: `[북막골] 내일 예약 리마인더 - ${data.bookingNumber}`,\n    body: `안녕하세요, ${data.name}님!\n\n내일 북막골 ${data.branchInfo.name} 예약이 있습니다.\n\n━━━━━━━━━━━━━━━━━━━━━\n📋 예약 정보\n━━━━━━━━━━━━━━━━━━━━━\n\n예약번호: ${data.bookingNumber}\n날짜: ${data.dateFormatted}\n시간: ${data.timeFormatted}\n지점: ${data.branchInfo.name}\n공간: ${data.spaceInfo}\n인원: ${data.guests}명\n\n━━━━━━━━━━━━━━━━━━━━━\n📍 오시는 길\n━━━━━━━━━━━━━━━━━━━━━\n\n${data.branchInfo.address}\n전화: ${data.branchInfo.phone}\n\n🗺️ 길찾기: ${data.googleMapsLink}\n\n━━━━━━━━━━━━━━━━━━━━━\n⚠️ 안내사항\n━━━━━━━━━━━━━━━━━━━━━\n\n• 예약 시간 10분 전까지 도착해주세요\n• 취소/변경이 필요하시면 미리 연락주세요\n• 영업시간: 11:00-15:00, 16:00-22:00\n${data.specialRequest ? `• 특별요청: ${data.specialRequest}` : ''}\n\n내일 뵙겠습니다!\n\n북막골 드림`\n  },\n  th: {\n    subject: `[Bookmakgol] เตือนความจำการจองพรุ่งนี้ - ${data.bookingNumber}`,\n    body: `สวัสดีค่ะ/ครับ คุณ${data.name}!\n\nพรุ่งนี้คุณมีการจองที่ Bookmakgol ${data.branchInfo.name}\n\n━━━━━━━━━━━━━━━━━━━━━\n📋 ข้อมูลการจอง\n━━━━━━━━━━━━━━━━━━━━━\n\nเลขที่การจอง: ${data.bookingNumber}\nวันที่: ${data.dateFormatted}\nเวลา: ${data.timeFormatted}\nสาขา: ${data.branchInfo.name}\nพื้นที่: ${data.spaceInfo}\nจำนวน: ${data.guests} ท่าน\n\n━━━━━━━━━━━━━━━━━━━━━\n📍 ที่อยู่\n━━━━━━━━━━━━━━━━━━━━━\n\n${data.branchInfo.address}\nโทร: ${data.branchInfo.phone}\n\n🗺️ นำทาง: ${data.googleMapsLink}\n\n━━━━━━━━━━━━━━━━━━━━━\n⚠️ ข้อแนะนำ\n━━━━━━━━━━━━━━━━━━━━━\n\n• กรุณามาถึงก่อนเวลานัด 10 นาที\n• หากต้องการยกเลิกหรือเปลี่ยนแปลง กรุณาแจ้งล่วงหน้า\n• เวลาเปิดให้บริการ: 11:00-15:00, 16:00-22:00\n${data.specialRequest ? `• ความต้องการพิเศษ: ${data.specialRequest}` : ''}\n\nแล้วพบกันพรุ่งนี้นะคะ/ครับ!\n\nBookmakgol`\n  },\n  en: {\n    subject: `[Bookmakgol] Reservation Reminder for Tomorrow - ${data.bookingNumber}`,\n    body: `Hello ${data.name},\n\nThis is a reminder for your reservation tomorrow at Bookmakgol ${data.branchInfo.name}.\n\n━━━━━━━━━━━━━━━━━━━━━\n📋 Booking Information\n━━━━━━━━━━━━━━━━━━━━━\n\nBooking Number: ${data.bookingNumber}\nDate: ${data.dateFormatted}\nTime: ${data.timeFormatted}\nBranch: ${data.branchInfo.name}\nSpace: ${data.spaceInfo}\nParty Size: ${data.guests} guests\n\n━━━━━━━━━━━━━━━━━━━━━\n📍 Location\n━━━━━━━━━━━━━━━━━━━━━\n\n${data.branchInfo.address}\nPhone: ${data.branchInfo.phone}\n\n🗺️ Directions: ${data.googleMapsLink}\n\n━━━━━━━━━━━━━━━━━━━━━\n⚠️ Important Notes\n━━━━━━━━━━━━━━━━━━━━━\n\n• Please arrive 10 minutes before your reservation time\n• Contact us in advance if you need to cancel or modify\n• Operating Hours: 11:00-15:00, 16:00-22:00\n${data.specialRequest ? `• Special Requests: ${data.specialRequest}` : ''}\n\nSee you tomorrow!\n\nBest regards,\nBookmakgol`\n  }\n};\n\nconst template = templates[data.language];\n\nreturn [{\n  json: {\n    ...data,\n    emailSubject: template.subject,\n    emailBody: template.body\n  }\n}];"
      },
      "id": "6f7a8b9c-0d1e-2f3a-4b5c-6d7e8f9a0b1c",
      "name": "리마인더 템플릿 생성",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1240,
        200
      ]
    },
    {
      "parameters": {
        "sendTo": "={{$json.email}}",
        "subject": "={{$json.emailSubject}}",
        "emailType": "text",
        "message": "={{$json.emailBody}}",
        "options": {}
      },
      "id": "7a8b9c0d-1e2f-3a4b-5c6d-7e8f9a0b1c2d",
      "name": "리마인더 이메일 발송",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 1,
      "position": [
        1440,
        200
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": "={{$json.pageId}}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Reminder Sent",
              "checkboxValue": true
            }
          ]
        }
      },
      "id": "8b9c0d1e-2f3a-4b5c-6d7e-8f9a0b1c2d3e",
      "name": "리마인더 발송 표시",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        1640,
        200
      ]
    },
    {
      "parameters": {
        "functionCode": "// Processing completion log\nconst processedCount = items.length;\nconst currentTime = new Date().toLocaleString('en-US', {\n  timeZone: 'Asia/Bangkok'\n});\n\nconsole.log(`[${currentTime}] Reminder sending completed: ${processedCount} items`);\n\nreturn [{\n  json: {\n    processedCount,\n    processedAt: currentTime,\n    message: `Successfully sent ${processedCount} reminders.`\n  }\n}];"
      },
      "id": "9c0d1e2f-3a4b-5c6d-7e8f-9a0b1c2d3e4f",
      "name": "처리 완료 로그",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1840,
        200
      ]
    }
  ],
  "connections": {
    "스케줄 트리거": {
      "main": [
        [
          {
            "node": "내일 날짜 계산",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "내일 날짜 계산": {
      "main": [
        [
          {
            "node": "내일 예약 조회",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "내일 예약 조회": {
      "main": [
        [
          {
            "node": "예약 존재 확인",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "예약 존재 확인": {
      "main": [
        [],
        [
          {
            "node": "리마인더 데이터 준비",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "리마인더 데이터 준비": {
      "main": [
        [
          {
            "node": "리마인더 템플릿 생성",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "리마인더 템플릿 생성": {
      "main": [
        [
          {
            "node": "리마인더 이메일 발송",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "리마인더 이메일 발송": {
      "main": [
        [
          {
            "node": "리마인더 발송 표시",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "리마인더 발송 표시": {
      "main": [
        [
          {
            "node": "처리 완료 로그",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "Asia/Bangkok"
  },
  "versionId": "1",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "bookmakgol-reminder-system-english",
  "tags": []
}
