# 북막골 예약 시스템 개발 계획서

## 프로젝트 개요

**목적**: 북막골 2개 지점(에까마이, 프롬퐁)의 룸/홀 예약을 웹으로 받고, Notion으로 관리하며, 자동 이메일 알림을 발송하는 시스템 구축

**주요 기능**:
- 3개 언어 지원 (Thai / 한국어 / English)
- 실시간 예약 가능 여부 확인
- 관리자 예약 확정 후 자동 이메일 발송
- 예약 하루 전 리마인더 발송

---

## 1. 시스템 아키텍처

```
손님 웹 예약
    ↓
n8n Webhook (중복 체크)
    ↓
Notion Database (저장)
    ↓
식당 이메일 알림 (예약대기)
    ↓
관리자 Notion에서 확정
    ↓
Notion Webhook 트리거
    ↓
n8n 워크플로우
    ↓
손님 이메일 발송 (선택한 언어로)
    ↓
n8n 스케줄러 (매일 오전 9시)
    ↓
내일 예약 조회 → 리마인더 발송
```

---

## 2. 식당 정보

### 에까마이 지점

**룸**:
- 1번룸: 최대 16명
- 2번룸: 최대 6명
- 평균 이용시간: 3-4시간

**홀 테이블**:
- 1층: 8개
- 2층: 7개

**영업시간**: 
- 11:00 - 15:00 (Break 1hr)
- 16:00 - 22:00

**전화**: 095-868-6826

**주소**: 에카마이 BTS 4번 출구, 수쿰윗 병원 맞은편

### 프롬퐁 지점

**룸**:
- 1번룸: 최대 16명
- 2번룸: 최대 4명
- 평균 이용시간: 3-4시간

**홀 테이블**:
- 1층: 7개
- 2층: 8개

**영업시간**: 
- 11:00 - 15:00 (Break 1hr)
- 16:00 - 22:00

**전화**: 02-115-5500

**주소**: 수쿰윗 소이 24, 아리스톤 호텔 1층

---

## 3. Notion 데이터베이스 구조

### Database Name: 북막골 예약 관리

### Properties

| Property | Type | Options/Description |
|----------|------|---------------------|
| 예약번호 | Title | 자동 생성 ID (BOOK-YYYYMMDD-XXX) |
| 예약일시 | Date | 날짜와 시간 포함 |
| 지점 | Select | Ekamai, Phrom Phong |
| 공간유형 | Select | 룸, 홀 |
| 룸번호 | Select | 1번룸, 2번룸 (공간유형=룸일 때만) |
| 층 | Select | 1층, 2층 (공간유형=홀일 때만) |
| 인원 | Number | |
| 이름 | Text | |
| 전화번호 | Phone Number | |
| 이메일 | Email | 필수 항목 |
| 언어 | Select | Thai, Korean, English |
| 특별요청 | Text | Long text |
| 상태 | Select | Pending (입금대기), Confirmed (확정), Completed (완료), Cancelled (취소) |
| 리마인더발송 | Checkbox | 하루 전 리마인더 발송 여부 |
| **영수증** | **Files & media** | **입금 영수증 (Room 1: 800 THB, Room 2: 400 THB)** |
| 생성일시 | Created time | 자동 |
| 수정일시 | Last edited time | 자동 |

### Views

1. **📅 캘린더 뷰**: 예약일시 기준으로 달력 표시
2. **📋 전체 예약**: 테이블 뷰, 최신순 정렬
3. **📊 상태별 관리**: 보드 뷰 (상태별로 그룹화)
4. **⏰ 오늘 예약**: 필터(예약일시 = today)
5. **📬 예약대기**: 필터(상태 = 예약대기)

---

## 4. 프론트엔드 - 예약 폼

### 4.1 파일 구조

```
GitHub Repository: bookmakgol-reservation
- index.html (예약 폼)
- location.html (기존 길찾기 페이지)
```

### 4.2 예약 폼 항목

**Step 1: 기본 정보**
1. 언어 선택 (Thai / 한국어 / English)
   - 선택 즉시 전체 UI 언어 변경

**Step 2: 예약 정보**
2. 지점 선택 (Ekamai / Phrom Phong)
3. 날짜 선택 (Datepicker)
4. 시간 선택 (30분 단위)
   - 영업시간: 11:00-15:00, 16:00-22:00
   - Break time 제외
5. 공간 선택 (룸 / 홀)
6. 상세 선택:
   - 룸 선택시: 1번룸(최대인원 표시) / 2번룸(최대인원 표시)
   - 홀 선택시: 1층 / 2층
7. 인원 수 입력

**Step 3: 연락처 정보**
8. 이름 (필수)
9. 전화번호 (필수)
10. 이메일 (필수) - 형식 검증
11. 특별 요청 (선택)

### 4.3 UI/UX 요구사항

- 모바일 최적화 (라인 앱에서 주로 사용)
- 북막골 인테리어 컬러 톤 (크림/베이지, 우드 브라운)
- 실시간 유효성 검증
- 중복 예약 체크 (제출 시)
- 로딩 상태 표시
- 성공/실패 메시지

### 4.4 중복 예약 체크 로직

**룸 예약**:
- 같은 날짜, 같은 시간, 같은 지점, 같은 룸번호 → 중복
- 룸 평균 사용시간 3-4시간 고려 (예: 18:00 예약 → 22:00까지 차단)

**홀 예약**:
- 테이블은 중복 체크 안 함 (선착순)

---

## 5. n8n 워크플로우

### 5.1 워크플로우 1: 예약 접수 및 확정

**Workflow Name**: 북막골_예약접수및확정

#### 노드 구성:

```
1. Webhook
   - Method: POST
   - Path: /bookmakgol-reservation
   - 받는 데이터: 예약 폼 전체 필드

2. Function - 데이터 검증
   - 필수 항목 체크
   - 이메일 형식 검증
   - 날짜/시간 형식 변환

3. Notion - Query Database
   - Database: 북막골 예약 관리
   - Filter: 
     * 예약일시 = 입력된 날짜/시간
     * 지점 = 입력된 지점
     * 공간유형 = 룸
     * 룸번호 = 입력된 룸번호
     * 상태 ≠ 취소

4. IF - 중복 체크
   - True (중복 있음): Error 응답
   - False (중복 없음): 계속 진행

5. Function - 예약번호 생성
   - 형식: BOOK-YYYYMMDD-XXX
   - XXX는 해당 날짜의 순번

6. Notion - Create Page
   - Database: 북막골 예약 관리
   - Properties: 모든 예약 정보
   - 상태: 예약대기

7. Gmail - 식당 알림
   - To: 식당 관리자 이메일
   - Subject: [북막골] 새 예약 - {지점} - {예약일시}
   - Body: 예약 정보 전체

8. Respond to Webhook
   - Success: { status: "success", bookingNumber: "..." }
   - Error: { status: "error", message: "..." }
```

### 5.2 워크플로우 2: 예약 확정 이메일

**Workflow Name**: 북막골_예약확정이메일

#### 노드 구성:

```
1. Notion Trigger
   - Database: 북막골 예약 관리
   - Trigger: Database Updated
   - Filter: 상태가 "확정"으로 변경될 때

2. Function - 언어별 이메일 템플릿 선택
   - 언어 필드 읽기
   - 해당 언어 템플릿 선택

3. Gmail - 손님 확정 알림
   - To: 예약자 이메일
   - Subject: 언어별 제목
   - Body: 언어별 템플릿
   - 포함 내용:
     * 예약번호
     * 예약일시
     * 지점 정보 (주소, 전화)
     * 구글맵 링크
     * 예약 내용
     * 취소/변경 안내
```

### 5.3 워크플로우 3: 예약 리마인더

**Workflow Name**: 북막골_예약리마인더

#### 노드 구성:

```
1. Schedule Trigger
   - Cron: 0 9 * * * (매일 오전 9시)
   - Timezone: Asia/Bangkok

2. Function - 내일 날짜 계산
   - 현재 날짜 + 1일

3. Notion - Query Database
   - Database: 북막골 예약 관리
   - Filter:
     * 예약일시 = 내일
     * 상태 = 확정
     * 리마인더발송 = false

4. Loop - 각 예약마다
   4.1. Function - 언어별 템플릿 선택
   
   4.2. Gmail - 리마인더 발송
        - To: 예약자 이메일
        - Subject: 언어별 제목
        - Body: 언어별 리마인더 템플릿
   
   4.3. Notion - Update Page
        - 리마인더발송 = true
```

---

## 6. 이메일 템플릿

### 6.1 예약 확정 이메일

#### 한국어

```
제목: [북막골] 예약이 확정되었습니다 - {예약번호}

안녕하세요, {이름}님!

북막골 {지점} 지점 예약이 확정되었습니다.

━━━━━━━━━━━━━━━━━━━━━
📋 예약 정보
━━━━━━━━━━━━━━━━━━━━━

예약번호: {예약번호}
날짜: {YYYY년 MM월 DD일 (요일)}
시간: {HH:MM}
지점: {지점}
공간: {공간유형} {상세}
인원: {인원}명

━━━━━━━━━━━━━━━━━━━━━
📍 오시는 길
━━━━━━━━━━━━━━━━━━━━━

{지점별 주소}
전화: {전화번호}

🗺️ 길찾기: {구글맵 링크}

━━━━━━━━━━━━━━━━━━━━━
⚠️ 예약 안내
━━━━━━━━━━━━━━━━━━━━━

• 예약 취소/변경: 전화 또는 라인으로 연락주세요
• 룸 예약: 평균 이용시간 3-4시간
• 영업시간: 11:00-15:00, 16:00-22:00

맛있는 식사 준비하고 기다리겠습니다!

감사합니다.
북막골 드림
```

#### ภาษาไทย (Thai)

```
หัวเรื่อง: [Bookmakgol] การจองของคุณได้รับการยืนยันแล้ว - {เลขที่การจอง}

สวัสดีค่ะ/ครับ คุณ{ชื่อ}!

การจองของคุณที่ Bookmakgol สาขา{สาขา} ได้รับการยืนยันแล้ว

━━━━━━━━━━━━━━━━━━━━━
📋 ข้อมูลการจอง
━━━━━━━━━━━━━━━━━━━━━

เลขที่การจอง: {เลขที่การจอง}
วันที่: {วันที่}
เวลา: {เวลา}
สาขา: {สาขา}
พื้นที่: {ประเภทพื้นที่} {รายละเอียด}
จำนวน: {จำนวน} ท่าน

━━━━━━━━━━━━━━━━━━━━━
📍 ที่อยู่
━━━━━━━━━━━━━━━━━━━━━

{ที่อยู่ตามสาขา}
โทร: {เบอร์โทร}

🗺️ นำทาง: {ลิงก์แผนที่}

━━━━━━━━━━━━━━━━━━━━━
⚠️ ข้อมูลการจอง
━━━━━━━━━━━━━━━━━━━━━

• ยกเลิก/เปลี่ยนแปลง: โทรหรือแจ้งทาง Line
• การจองห้อง: เวลาใช้งานโดยเฉลี่ย 3-4 ชั่วโมง
• เวลาเปิดให้บริการ: 11:00-15:00, 16:00-22:00

เตรียมอาหารอร่อยรอคุณอยู่นะคะ/ครับ!

ขอบคุณค่ะ/ครับ
Bookmakgol
```

#### English

```
Subject: [Bookmakgol] Your Reservation is Confirmed - {Booking Number}

Hello {Name},

Your reservation at Bookmakgol {Branch} has been confirmed.

━━━━━━━━━━━━━━━━━━━━━
📋 Booking Information
━━━━━━━━━━━━━━━━━━━━━

Booking Number: {Booking Number}
Date: {Date}
Time: {Time}
Branch: {Branch}
Space: {Space Type} {Detail}
Party Size: {Number} guests

━━━━━━━━━━━━━━━━━━━━━
📍 Location
━━━━━━━━━━━━━━━━━━━━━

{Branch Address}
Phone: {Phone Number}

🗺️ Directions: {Google Maps Link}

━━━━━━━━━━━━━━━━━━━━━
⚠️ Important Information
━━━━━━━━━━━━━━━━━━━━━

• Cancel/Modify: Please call or message via Line
• Private Room: Average duration 3-4 hours
• Operating Hours: 11:00-15:00, 16:00-22:00

We look forward to serving you!

Best regards,
Bookmakgol
```

### 6.2 리마인더 이메일

각 언어별로 간단한 리마인더:
- "내일 예약이 있습니다"
- 예약 정보 요약
- 지점 정보
- 문의 연락처

---

## 7. 개발 단계

### Phase 1: Notion 설정 (30분)
- [ ] Notion Database 생성
- [ ] Properties 설정
- [ ] Views 생성
- [ ] Integration 생성 (API 키 발급)

### Phase 2: 프론트엔드 개발 (3-4시간)
- [ ] HTML 구조 작성
- [ ] CSS 스타일링 (북막골 컬러 톤)
- [ ] JavaScript 폼 검증
- [ ] 언어 전환 기능
- [ ] 날짜/시간 선택 UI
- [ ] API 연동 (n8n webhook 호출)
- [ ] GitHub Pages 배포

### Phase 3: n8n 워크플로우 1 (2-3시간)
- [ ] Webhook 노드 설정
- [ ] Notion 연동
- [ ] 중복 체크 로직
- [ ] Gmail 알림 설정
- [ ] 테스트

### Phase 4: n8n 워크플로우 2 (1-2시간)
- [ ] Notion Trigger 설정
- [ ] 언어별 이메일 템플릿
- [ ] Gmail 발송 설정
- [ ] 테스트

### Phase 5: n8n 워크플로우 3 (1-2시간)
- [ ] Schedule Trigger 설정
- [ ] 리마인더 로직
- [ ] 테스트

### Phase 6: 통합 테스트 (1-2시간)
- [ ] 전체 플로우 테스트 (예약→확정→리마인더)
- [ ] 3개 언어 모두 테스트
- [ ] 모바일 테스트
- [ ] 에러 케이스 테스트

### Phase 7: 배포 및 교육 (1시간)
- [ ] 라인 리치메뉴 연동
- [ ] 관리자 교육 (Notion 사용법)
- [ ] 매뉴얼 작성

**예상 총 소요시간**: 10-15시간

---

## 8. 필요한 리소스

### 기술 스택
- ✅ GitHub (Dylan님 계정 있음)
- ✅ Notion (무제한 공간)
- ✅ n8n (구글 클라우드 셀프 호스팅)
- ✅ Google Workspace (Gmail API)

### 추가 필요 항목
- 식당 관리자 이메일 주소
- Notion Integration API 키
- n8n Webhook URL

---

## 8. 예약금 시스템 (Deposit System)

### 8.1 개요

**목적**: Room 예약 시 노쇼(No-show) 방지를 위한 예약금 시스템

**적용 대상**:
- Room 예약만 해당 (홀/테이블 예약은 예약금 없음)

**예약금 금액**:
- Room 1 (1번룸): 800 THB
- Room 2 (2번룸): 400 THB

**입금 계좌 정보**:
- 은행: Kasikorn Bank
- 계좌번호: 047-3-53876-8
- 예금주: Bookmagol (Thailand) / บุคมาโกล ไทยแลนด์ จำกัด

### 8.2 예약금 프로세스

```
1. 고객: Room 예약 신청 (웹폼)
   ↓
2. 시스템: 예약 접수 완료 화면에 예약금 정보 표시
   - 예약금 금액
   - 은행 계좌 정보
   - 입금 기한 (1시간 이내)
   - LINE 공식 계정 링크
   ↓
3. 고객: 입금 후 LINE으로 영수증 전송
   - LINE 공식 계정: @853oabjm
   - 전송 내용: 영수증 + 이름 + 예약 날짜
   ↓
4. 관리자: LINE에서 영수증 확인
   ↓
5. 관리자: Notion에서 수동 업데이트
   - 예약금상태: Unpaid → Paid
   - 예약금메모: 입금자명, 시간 기록
   ↓
6. 관리자: 이메일에서 "확정" 버튼 클릭
   ↓
7. 시스템: 고객에게 최종 확정 이메일 발송
```

### 8.3 고객 화면 (예약 완료 화면)

#### 한국어 예시

```
✅ 예약이 접수되었습니다!

━━━━━━━━━━━━━━━━━━━━━
📋 예약 정보
━━━━━━━━━━━━━━━━━━━━━

예약번호: BOOK-20251031-001
날짜: 2025년 11월 1일 (금요일)
시간: 18:00
지점: 에까마이 지점
공간: Room 1
인원: 6명

━━━━━━━━━━━━━━━━━━━━━
💰 예약금 안내 (필수)
━━━━━━━━━━━━━━━━━━━━━

예약금: 800 THB

입금 계좌:
• 은행: Kasikorn Bank
• 계좌번호: 047-3-53876-8
• 예금주: Bookmagol (Thailand)
        บุคมาโกล ไทยแลนด์ จำกัด

⏰ 입금 기한: 1시간 이내

입금 후 LINE으로 영수증을 보내주세요:
[📱 LINE으로 영수증 보내기]

(버튼 클릭 시 LINE 앱 자동 실행)
LINE ID: @853oabjm

전송 시 다음 정보를 함께 보내주세요:
✓ 이름: 홍길동
✓ 예약 날짜: 11월 1일 18:00
✓ 영수증 사진

━━━━━━━━━━━━━━━━━━━━━
⚠️ 안내사항
━━━━━━━━━━━━━━━━━━━━━

• 입금 확인 후 예약이 최종 확정됩니다
• 기한 내 미입금 시 예약이 취소될 수 있습니다
• 문의: [지점 전화번호]
```

### 8.4 관리자 운영 가이드

#### Notion 관리

**예약금 미입금 상태**
- Room 예약 → Status: Pending (입금 대기)
- Deposit Receipt: empty (영수증 미업로드)

**입금 확인 후 처리 (3단계만!)**
1. LINE에서 영수증 확인 → 저장
2. Notion 검색 (이름+날짜) → Deposit Receipt에 업로드
3. Status: Pending → Confirmed → 끝!

💡 **영수증에 모든 정보 포함:** 입금일시, 금액, 입금자명  
💡 **추가 필드 불필요:** Deposit Receipt 1개만!

#### LINE 공식 계정 운영

**LINE ID**: @853oabjm
**링크**: https://line.me/R/ti/p/@853oabjm

**링크 동작**:
- 모바일: 클릭 시 LINE 앱 자동 실행 및 북막골 계정 열림
- 데스크톱: LINE 웹 또는 앱으로 연결
- 버튼 형태로 구현하여 쉽게 클릭 가능

**고객이 보내는 정보**:
- 영수증 이미지
- 예약자 이름
- 예약 날짜 및 시간

**응대 예시**:
```
고객: "안녕하세요! 홍길동, 11월 1일 저녁 6시 예약
      예약금 입금했습니다 [영수증 이미지]"

직원: "홍길동님 입금 확인했습니다! 
      예약이 확정되면 이메일로 안내드리겠습니다. 
      감사합니다 😊"
```

### 8.5 기술 구현

#### 프론트엔드 (index.html)

**수정 사항**:
- 예약 성공 메시지에 예약금 정보 섹션 추가
- Room 예약 시만 표시 (Hall은 표시 안 함)
- 자동 새로고침 제거 (고객이 정보 확인 가능하도록)
- LINE 버튼 추가: https://line.me/R/ti/p/@853oabjm
  - 클릭 시 LINE 앱 자동 실행
  - 북막골 공식 계정 자동 연결
  - 모바일/데스크톱 모두 지원
- 3개 언어별 템플릿 (한국어/태국어/영어)

#### n8n 워크플로우 (workflow-bookmakgol-integrated.json)

**"예약번호 생성" Function 노드 수정**:
```javascript
// 예약금 계산 로직 추가
let depositAmount = 0;
if (data.spaceType === 'Room') {
  if (data.spaceDetail === 'Room 1') {
    depositAmount = 800;
  } else if (data.spaceDetail === 'Room 2') {
    depositAmount = 400;
  }
}

return [{
  json: {
    ...existingData,
    depositAmount: depositAmount,
    depositStatus: depositAmount > 0 ? 'Unpaid' : null
  }
}];
```

**"Notion에 저장" 노드 수정**:
- Deposit Amount 필드 추가
- Deposit Status 필드 추가 (Unpaid/null)

### 8.6 제한사항 및 주의사항

**제한사항**:
- 예약금 확인은 수동 프로세스 (자동화 안 됨)
- 은행 API 연동 없음 (수동 확인)
- 입금 기한 자동 체크 없음 (관리자 판단)

**주의사항**:
- 입금 기한(1시간)은 권장사항이며, 유연하게 운영 가능
- 예약금 환불 정책은 별도 수립 필요
- 영업시간 외 예약 시 입금 기한 조정 필요

### 8.7 향후 개선 가능 사항

**단기 (선택사항)**:
- 입금 기한 자동 알림 (10분 전 리마인더)
- 미입금 자동 취소 워크플로우

**중기 (선택사항)**:
- Gmail Webhook으로 영수증 자동 수신 처리
- 은행 API 연동으로 자동 입금 확인

**장기 (선택사항)**:
- 온라인 결제 연동 (PromptPay QR)
- 예약금 자동 환불 시스템

---

## 9. 향후 개선 사항

### 단기 (1-3개월)
- 예약 현황 대시보드 (관리자용)
- SMS 알림 추가 (선택사항)
- 예약 통계 리포트

### 중기 (3-6개월)
- 온라인 결제 연동 (deposit)
- 대기자 명단 관리
- 고객 리뷰 시스템

### 장기 (6개월+)
- 커스텀 도메인 (bookmakgol.com)
- 모바일 앱 개발
- CRM 연동

---

## 10. 연락처 및 지원

**프로젝트 관리자**: Dylan Kwak
**이메일**: (추가 예정)
**GitHub**: dylankwak57

---

**문서 버전**: 1.0
**작성일**: 2025-10-02
**최종 수정일**: 2025-10-02